https://docs.microsoft.com/nb-no/learn/paths/az-104-administrator-prerequisites/

AZ-104: Prerequisites for Azure administrators
TODO 3h
Configure Azure resources with tools
Use Azure Resource Manager
Explore the Azure Resource Manager template parameters

In the parameters section of the template, you specify which values you can input when deploying the resources. The available properties for a parameter are:
"parameters": 
    { "<parameter-name>" :
        { "type" : "<type-of-parameter-value>",
         "defaultValue": "<default-value-of-parameter>",
          "allowedValues": [ "<array-of-allowed-values>" ], 
           "minValue": <minimum-value-for-int>,
           "maxValue": <maximum-value-for-int>,
            "minLength": <minimum-length-for-string-or-array>, 
            "maxLength": <maximum-length-for-string-or-array-parameters>,
             "metadata": { "description": "<description-of-the parameter>" } } }


Windows
Azure Az PowerShell module
Linux
On Linux, the package manager will change based on the Linux distribution you choose.
LINUX
Distribution(s)	Package manager
Ubuntu, Debian	apt-get
Red Hat, CentOS	yum
OpenSUSE	zypper
Fedora	dnf
Mac
On macOS, you will use Homebrew to install PowerShell.

Powershell cmdlets
* to get help on the Get-ChildItem cmdlet, enter the following statement in a Windows PowerShell session:
Get-Help -Name Get-ChildItem -Detailed
* You can get a list of loaded modules using the Get-Module command:
Get-Module

$PSVersionTable.PSVersion
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
Install-Module -Name Az -Scope CurrentUser -Repository PSGallery -Force
# Take a coffee, this takes time, answer Yx2 and wait, when done, close/open Powershell and verify module
# Minimum Powershell v is 5.1
Get-InstalledModule -Name Az

* Update a PowerShell module
Update-Module -Name Az

Connect AzAccount
* or
Connect AzAccount -TenantId The-tenant-id-we-copied-from-azure-ad

* iF Created multiple Azure subscriptions. You can configure Azure PowerShell to execute commands against a particular subscription.
Set-AzContext -Subscription '00000000-0000-0000-0000-000000000000'

* Get a list of all resource groups
Get-AzResourceGroup | Format-Table

* Create a resource group
New-AzResourceGroup -Name <name> -Location <location>

$rg = “testit2-rg”
Get-AzResource -ResourceGroupName $rg

* Create an Azure Virtual Machine
New-AzVm
       -ResourceGroupName <resource group name>
       -Name <machine name>
       -Credential <credentials object>
       -Location <location>
       -Image <image name>

* The AzVM suffix is specific to VM-based commands in PowerShell. There are several others you can use:
Command	Description
Remove-AzVM	      Deletes an Azure VM.
Start-AzVM	      Start a stopped VM.
Stop-AzVM	      Stop a running VM.
Restart-AzVM	  Restart a VM.
Update-AzVM	      Updates the configuration for a VM.

* The interesting thing is that now your VM is an object you can interact with
$ResourceGroupName = "ExerciseResources"
$vm = Get-AzVM  -Name MyVM -ResourceGroupName $ResourceGroupName
$vm.HardwareProfile.vmSize = "Standard_DS3_v2"

Update-AzVM -ResourceGroupName $ResourceGroupName  -VM $vm


Exercise - Create an Azure Resource using scripts in Azure PowerShell

Connect-AzAccount

* Create a Linux VM with Azure PowerShell
* Add the -OpenPorts parameter, and pass "22" as the port. This will let us SSH into the machine.

New-AzVm -ResourceGroupName learn-9a7c6d9b-5436-4341-9ac2-61a67345466e -Name "testvm-eus-01" -Credential (Get-Credential) -Location "East US" -Image UbuntuLTS -OpenPorts 22
Dhamapada, Dhamapada-eat-carrot-ls45

$vm = (Get-AzVM -Name "testvm-eus-01" -ResourceGroupName learn-9a7c6d9b-5436-4341-9ac2-61a67345466e)

* Query the value to dump out the information about the VM.
$vm
$vm.HardwareProfile
$vm.StorageProfile.OsDisk
$vm | Get-AzPublicIpAddress

ssh Dhamapada@111.11.11.1
exit

* Delete a VM
Stop-AzVM -Name $vm.Name -ResourceGroup $vm.ResourceGroupName
Get-AzResource -ResourceGroupName $vm.ResourceGroupName | Format-Table
Remove-AzVM -Name $vm.Name -ResourceGroup $vm.ResourceGroupName -Force -As-Job
Get-AzResource -ResourceGroupName $vm.ResourceGroupName | Format-Table

* Delete the network interface.
$vm | Remove-AzNetworkInterface –Force

Delete the managed OS disks and storage account.
Get-AzDisk -ResourceGroupName $vm.ResourceGroupName -DiskName $vm.StorageProfile.OSDisk.Name | Remove-AzDisk -Force

* Next, delete the virtual network.
Get-AzVirtualNetwork -ResourceGroup $vm.ResourceGroupName | Remove-AzVirtualNetwork -Force

* Delete the network security group.
Get-AzNetworkSecurityGroup -ResourceGroup $vm.ResourceGroupName | Remove-AzNetworkSecurityGroup -Force

* And finally, delete the public IP address.
Get-AzPublicIpAddress -ResourceGroup $vm.ResourceGroupName | Remove-AzPublicIpAddress -Force


Exercise - Create and save scripts in Azure PowerShell

cd $HOME\clouddrive
touch "./ConferenceDailyReset.ps1"
code "./ConferenceDailyReset.ps1" # Integrated editor azure portal
* Start by capturing the input parameter in a variable. Add the following line to your script.
param([string]$resourceGroup)
* Prompt for a username and password for the VM's admin account and capture the result in a variable.

param([string]$resourceGroup)
$adminCredential = Get-Credential -Message "Enter a username and password for the VM administrator."
For ($i = 1; $i -le 3; $i++) 
{
    $vmName = "ConferenceDemo" + $i
    Write-Host "Creating VM: " $vmName
    New-AzVm -ResourceGroupName $resourceGroup -Name $vmName -Credential $adminCredential -Image UbuntuLTS
}

Get-AzResource -ResourceType Microsoft.Compute/virtualMachines

Clean up
* The sandbox automatically cleans up your resources when you're finished with this module.
Remove-AzResourceGroup -Name MyResourceGroupName

Control Azure services with the CLI

As part of the testing, you want to compare app performance for different data sources, 
and for different types of data connections. You've noticed that when your development team uses the Azure portal to create a new test instance of the app, 
they don't always use exactly the same parameters. 
You plan to solve this problem by using a set of standard deployment commands for each app test, which can be automated if required, 
and which will work in the same way across all the computers used by your software team.

Azure CLI
variable="value"
variable=integer

PowerShell
$variable="value"
$variable=integer

az --version

$ az find
the following arguments are required: <CLI_TERM>

TRY THIS:
az find "az storage"
Give me any Azure CLI group and I’ll show the most popular commands within the group.

az find "az monitor activity-log list"
Give me any Azure CLI command and I’ll show the most popular parameters and subcommands.

az find "arm template"
You can also enter a search term, and I'll try to help find the best commands.

https://aka.ms/cli_ref
Read more about the command in reference docs

* Connect
az login
* Create
az group create --name <name> --location <location>
* Verify
az group list
az group list --output table

Exercise - Create an Azure website using the CLI
* let's use the Azure CLI to create a resource group, and then to deploy a web app into this resource group.

* create several variables that you will use in later commands
export RESOURCE_GROUP=learn-92e86fb8-eec3-486f-9306-f729f468c5ad
export AZURE_REGION=centralus
export AZURE_APP_PLAN=popupappplan-$RANDOM
export AZURE_WEB_APP=popupwebapp-$RANDOM

az group list --output table

* If you have several items in the group list, you can filter the return values by adding a --query option. Try the following command:
az group list --query "[?name == '$RESOURCE_GROUP']"

* Steps to create a service plan
* Create an App Service plan to run your app. The following command specifies the free pricing tier, but you can run az appservice plan create --help to see the other pricing tiers.
az appservice plan create --name $AZURE_APP_PLAN --resource-group $RESOURCE_GROUP --location $AZURE_REGION --sku FREE

* Verify that the service plan was created successfully by listing all your plans in a table.
az appservice plan list --output table

* Steps to create a web app
az webapp create --name $AZURE_WEB_APP --resource-group $RESOURCE_GROUP --plan $AZURE_APP_PLAN

* Verify that the app was created successfully by listing all your apps in a table.
az webapp list --output table

Name               Location    State    ResourceGroup                               DefaultHostName    AppServicePlan
-----------------  ----------  -------  ------------------------------------------  -----------------------------------  ------------------
popupwebapp-15123  Central US  Running  learn-92e86fb8-eec3-486f-9306-f729f468c5ad  popupwebapp-15123.azurewebsites.net  popupappplan-12763

* then my website URL would be: http://popupwebapp-15123.azurewebsites.net
* or curl curl $AZURE_WEB_APP.azurewebsites.net

Steps to deploy code from GitHub
* Let's use a simple PHP page available in the Azure Samples GitHub repository that displays "Hello World!" when it executes. Make sure to use the web app name you created.
az webapp deployment source config --name $AZURE_WEB_APP --resource-group $RESOURCE_GROUP --repo-url "https://github.com/Azure-Samples/php-docs-hello-world" --branch master --manual-integration

* Result
{
  "branch": "master",
  "deploymentRollbackEnabled": false,
  "id": "/subscriptions/538be7b9-15c9-4be0-a2ee-8d948e33ad6a/resourceGroups/learn-92e86fb8-eec3-486f-9306-f729f468c5ad/providers/Microsoft.Web/sites/popupwebapp-15123/sourcecontrols/web",
  "isGitHubAction": false,
  "isManualIntegration": true,
  "isMercurial": false,
  "kind": null,
  "location": "Central US",
  "name": "popupwebapp-15123",
  "repoUrl": "https://github.com/Azure-Samples/php-docs-hello-world",
  "resourceGroup": "learn-92e86fb8-eec3-486f-9306-f729f468c5ad",
  "systemData": null,
  "type": "Microsoft.Web/sites/sourcecontrols"
}

http://popupwebapp-15123.azurewebsites.net/

* Now gives Hello World

*Remove the rg

RG_GROUP="learn-92e86fb8-eec3-486f-9306-f729f468c5ad"
echo "Name of rg; $RG_GROUP"

RG_EXISTS= az group exists --name $RG_GROUP
echo "Does rg exist; $RG_EXISTS"

RG_RESULT= az group delete --name $RG_GROUP --no-wait --yes -y #--subscription
echo $RG_RESULT

az group list --output table
Name                                        Location    Status
------------------------------------------  ----------  --------
learn-92e86fb8-eec3-486f-9306-f729f468c5ad  westus      Deleting

Deploy Azure infrastructure by using JSON ARM templates








AZ-104: Manage identities and governance in Azure
TODO 4 hr 7 min

AZ-104: Implement and manage storage in Azure
TODO 4 hr 44 min

AZ-104: Deploy and manage Azure compute resources
TODO 6 hr 19 min

AZ-104: Configure and manage virtual networks for Azure administrators
TODO 8 hr

AZ-104: Monitor and back up Azure resources
4 hr 50 min




